<div class="gestion-materiel-page p-6 bg-gray-50 text-gray-900 min-h-screen">
  <!-- En-t√™te -->
  <div class="flex flex-col items-center mb-6">
    <div class="flex items-center gap-3 mb-4">
      <mat-icon color="warn" class="text-red-600 text-4xl"></mat-icon>
      <h2 class="text-3xl font-bold text-red-600">Gestion du Mat√©riel SportSync</h2>
    </div>

    <div class="w-full flex justify-end space-x-3">
      <button (click)="toggleView('form')" [class.bg-red-600]="showForm"
              class="flex items-center justify-center px-6 py-2 rounded-md text-white bg-gray-300 hover:bg-red-500 transition">
        Formulaire
      </button>
      <button (click)="toggleView('table')" [class.bg-red-600]="showTable"
              class="flex items-center justify-center px-6 py-2 rounded-md text-white bg-gray-300 hover:bg-red-500 transition">
        Liste
      </button>
    </div>
  </div>

  <!-- Message succ√®s -->
  <div *ngIf="successMessage" class="mb-6 text-green-600 font-medium max-w-5xl mx-auto text-center">
    {{ successMessage }}
  </div>

  <!-- FORMULAIRE -->
  <div *ngIf="showForm" class="bg-white rounded-lg p-6 shadow-md max-w-5xl mx-auto">
    <h3 class="text-xl font-semibold text-red-600 mb-4">Ajouter / Modifier un Mat√©riel</h3>

    <form [formGroup]="materielForm" (ngSubmit)="submitForm()" class="grid grid-cols-1 md:grid-cols-2 gap-6" novalidate>
      <div class="space-y-4">
        <ng-container *ngFor="let field of fields">
          <ng-container *ngIf="field.label !== '#'">
            <label class="block font-medium text-gray-700 mb-1">{{ field.label }}</label>

            <input *ngIf="field.type !== 'select' && field.type !== 'textarea'"
                   [type]="field.type"
                   [formControlName]="field.control"
                   [placeholder]="field.placeholder || ''"
                   class="w-full px-4 py-2 rounded-md border border-gray-300 text-gray-900
                        focus:outline-none focus:ring-2 focus:ring-red-500" />

            <select *ngIf="field.type === 'select'" [formControlName]="field.control"
                    class="w-full px-4 py-2 rounded-md border border-gray-300 text-gray-900 bg-white
                         focus:outline-none focus:ring-2 focus:ring-red-500">
              <option value="">S√©lectionner</option>
              <option *ngFor="let opt of field.options || []" [value]="opt">{{ opt | titlecase }}</option>
            </select>

            <textarea *ngIf="field.type === 'textarea'" [formControlName]="field.control" rows="3"
                      class="w-full px-4 py-2 rounded-md border border-gray-300 text-gray-900 resize-none
                           focus:outline-none focus:ring-2 focus:ring-red-500"></textarea>

            <div *ngIf="materielForm.get(field.control)?.invalid && (materielForm.get(field.control)?.touched || materielForm.get(field.control)?.dirty)"
                 class="text-red-600 text-sm mt-1">
              <span *ngIf="materielForm.get(field.control)?.errors?.['required']">Ce champ est requis</span>
              <span *ngIf="materielForm.get(field.control)?.errors?.['min']">Valeur trop petite</span>
            </div>
          </ng-container>
        </ng-container>

        <!-- Image -->
        <div>
          <label class="block font-medium text-gray-700 mb-1">Image</label>
          <input type="file" (change)="onFileSelected($event)"
                 class="block w-full text-sm text-gray-700
                      file:mr-4 file:py-2 file:px-4 file:border-0 file:font-semibold
                      file:bg-red-100 file:text-red-700 hover:file:bg-red-200 rounded-md" />
        </div>
      </div>

      <!-- Aper√ßu image -->
      <div class="flex items-center justify-center border-2 border-dashed border-gray-300 rounded-lg p-4 bg-gray-100">
        <img *ngIf="selectedFileUrl" [src]="selectedFileUrl" alt="Aper√ßu image"
             class="max-w-full max-h-64 rounded shadow" />
        <span *ngIf="!selectedFileUrl" class="text-gray-400 italic">Aucune image s√©lectionn√©e</span>
      </div>

      <!-- Boutons -->
      <div class="col-span-2 flex justify-end mt-4 space-x-4">
        <button type="submit" [disabled]="materielForm.invalid"
                class="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700 disabled:opacity-50">
          Enregistrer
        </button>
        <button type="button" (click)="cancelForm()"
                class="bg-gray-300 text-gray-900 px-6 py-2 rounded hover:bg-gray-400">
          Annuler
        </button>
      </div>
    </form>
  </div>

  <!-- LISTE -->
  <div *ngIf="showTable" class="mt-10 max-w-7xl mx-auto px-4 gestion-materiel-page">
    <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
      <h3 class="text-2xl font-semibold text-red-600 flex items-center gap-2">
        <mat-icon></mat-icon>
        Liste des Mat√©riels Disponibles
      </h3>


    </div>
  </div>
  <!-- TABLEAU -->
  <div *ngIf="showTable" class="max-w-6xl mx-auto mt-8 bg-white rounded-lg shadow-md p-4">
    <h3 class="text-xl font-semibold text-red-600 mb-4">Liste du mat√©riel</h3>

    <input type="text" placeholder="Recherche par nom ou type de sport..."
           [(ngModel)]="searchTerm" (input)="onFilterChange()"
           class="w-full mb-4 px-4 py-2 rounded-md border border-gray-300 text-gray-900
                  focus:outline-none focus:ring-2 focus:ring-red-500" />

    <table class="min-w-full border-collapse border border-gray-300">
      <thead class="bg-red-600 text-white">
      <tr>
        <th class="border border-gray-300 p-2">Nom</th>
        <th class="border border-gray-300 p-2">Type de sport</th>
        <th class="border border-gray-300 p-2">Quantit√©</th>
        <th class="border border-gray-300 p-2">Couleur</th>
        <th class="border border-gray-300 p-2">√âtat</th>
        <th class="border border-gray-300 p-2">Image</th>
        <th class="border border-gray-300 p-2">Note interne</th>
        <th class="border border-gray-300 p-2">Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let materiel of paginatedMateriels()" class="hover:bg-gray-100">
        <td class="border border-gray-300 p-2">{{ materiel.name }}</td>
        <td class="border border-gray-300 p-2">{{ materiel.sportType }}</td>
        <td class="border border-gray-300 p-2 text-center">{{ materiel.quantity }}</td>
        <td class="border border-gray-300 p-2">{{ materiel.color }}</td>
        <td class="border border-gray-300 p-2">{{ materiel.state }}</td>
        <td class="border border-gray-300 p-2 text-center">
          <img *ngIf="materiel.imageUrl" [src]="materiel.imageUrl" alt="Image" class="w-16 h-16 object-cover rounded-md mx-auto" />
          <span *ngIf="!materiel.imageUrl" class="text-gray-400 italic">Aucune</span>
        </td>
        <td class="border border-gray-300 p-2">{{ materiel.noteInterne }}</td>
        <td class="border border-gray-300 p-2 flex gap-2 justify-center">
          <button (click)="editMateriel(materiel)" matTooltip="Modifier" matTooltipPosition="left"
                  class="rounded px-2 py-1 hover:bg-gray-200">
            <mat-icon></mat-icon>‚úèÔ∏è
          </button>

          <button (click)="deleteMateriel(materiel.id)" matTooltip="Supprimer" matTooltipPosition="right"
                  class="rounded px-2 py-1 hover:bg-gray-200">
            <mat-icon></mat-icon>üóëÔ∏è
          </button>

        </td>
      </tr>
      <tr *ngIf="filteredMateriels.length === 0">
        <td colspan="8" class="text-center text-gray-500 py-4 italic">Aucun mat√©riel trouv√©</td>
      </tr>
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="mt-4 flex justify-between items-center">
      <button (click)="previousPage()" [disabled]="currentPage === 1"
              class="px-4 py-1 rounded border border-gray-300 hover:bg-gray-200 disabled:opacity-50">
        Pr√©c√©dent
      </button>
      <span>Page {{ currentPage }} / {{ totalPages() }}</span>
      <button (click)="nextPage()" [disabled]="currentPage === totalPages()"
              class="px-4 py-1 rounded border border-gray-300 hover:bg-gray-200 disabled:opacity-50">
        Suivant
      </button>
    </div>
  </div>
</div>

